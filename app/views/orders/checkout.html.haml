= provide(:page_title, 'Checkout')
- provide(:body_class, 'checkout')

.order-info
  %h1 Summary

  #order-cost
    - if @order.coupon
      %h4
        #{@order.video_length.name} -
        %s= number_to_currency @order.video_length.cost
      %h4
        \-
        = number_to_currency @order.coupon.discount
        (#{@order.coupon.name})
      %h4
        \=
        = @order.order_cost
    - else
      %h4 #{@order.video_length.name} - $#{@order.order_cost}


.row
  .col-md-12
    .errors-container(style='display: none;')
      %h2 The following errors occurred trying to process your order:
      .alert.alert-danger
        .payment-errors= flash[:stripe_error]
        .order-errors
.row
  .col-md-6
    = form_for @order, url: orders_path, html: { id: 'checkout' }, remote: true do |f|
      = f.hidden_field :preparing_for_payment, value: true
      %fieldset
        %legend
          %h3 Billing Info
        .form-group
          = f.label :cardholder_name, 'Name', class: 'control-label'
          = f.text_field :cardholder_name, class: 'form-control', placeholder: 'Name on Card'
        .form-group
          = f.label :cardholder_address, 'Address', class: 'control-label'
          = f.text_field :cardholder_address, class: 'form-control', placeholder: 'Address on Card'
        .form-group
          .row
            .col-md-4
              = f.label :cardholder_city, 'City', class: 'control-label'
              = f.text_field :cardholder_city, class: 'form-control', placeholder: 'City'
            .col-md-4
              = f.label :cardholder_state, 'State', class: 'control-label'
              = f.text_field :cardholder_state, class: 'form-control', placeholder: 'State'
            .col-md-4
              = f.label :cardholder_zipcode, 'Zip', class: 'control-label', placeholder: 'Zip'
              = f.text_field :cardholder_zipcode, class: 'form-control'
        .form-group
          = f.label :cardholder_email, 'Email', class: 'control-label'
          = f.text_field :cardholder_email, class: 'form-control', placeholder: 'Email'
        .form-group
          = f.label :cardholder_phone_number, 'Phone', class: 'control-label'
          = f.text_field :cardholder_phone_number, class: 'form-control', placeholder: 'Phone #'

  .col-md-6
    %form
      %fieldset
        %legend
          %h3 Credit Card Info
        .form-group
          %label.control-label(for='card_number')
            Card Number
          %input#card_number.form-control(type='text' placeholder='Credit Card Number')
        .form-group
          %label.control-label.hidden.col-sm-4(for='card_exp_month') Card Exp Month
          %label.control-label.hidden.col-sm-4(for='card_exp_year') Card Exp Year
          .row
            .col-md-6
              %label Expiration date
              .row
                .col-sm-4
                  %input#card_exp_month.form-control(type='text' placeholder='MM')
                .col-sm-4
                  %input#card_exp_year.form-control(type='text' placeholder='YYYY')
            .col-md-2.col-md-offset-4
              %label.control-label(for='card_cvc') CVC
              %input#card_cvc.form-control(type='text' placeholder='CVC')

    .coupon-container
      - unless @order.coupon
        = form_for :coupon, url: attach_coupon_orders_path, remote: true, html: { id: 'coupon_form' } do |f|
          .form-group
            = f.label :code, 'Got an ActiVid credit code?  Enter it below:'
            .row
              .col-md-4
                = f.text_field :code, class: 'form-control'
          = f.submit 'Use Coupon', class: 'btn btn-default', placeholder: 'Coupon code'

      - if @order.coupon
        %p You are using the coupon '#{@order.coupon.name}' for this purchase.

= form_tag submit_payment_orders_path, id: 'stripe-token-form', class: 'hidden' do
  = hidden_field_tag :stripe_token

.row
  .col-md-6
    .navigation
      = link_to 'Go Back', orders_path, class: 'btn btn-default'
  .col-md-6
    .navigation
      %button.checkout.btn.btn-primary(type="submit") Complete Order




- if flash[:stripe_error]
  :javascript
    $('.errors-container').show();

:javascript
  var order = {
    name: '#{@order.video_length.name}',
    cost: #{@order.order_cost.to_f},
    old_cost: #{@order.video_length.cost.to_f}
  };

:plain
  <script id="discount" type="text/x-mustache">
    <h4>{{order_name}} - <s>${{old_cost}}</s></h4>
    <h4>- ${{coupon_discount}} ({{coupon_name}})</h4>
    <h4>= ${{final_total}}</h4>
  </script>

